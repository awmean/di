{% extends 'base.html' %}

{% block title %}Luce di Villa - {% if current_category %}{{ current_category.name }}{% else %}Каталог мебели{% endif %}{% endblock %}

{% block meta %}
<!-- ItemList Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "{% if current_category %}{{ current_category.name }}{% else %}Каталог мебели Luce di Villa{% endif %}",
  "description": "{% if current_category and current_category.description %}{{ current_category.description }}{% else %}Современная дизайнерская мебель высокого качества. Диваны, столы, стулья и аксессуары с доставкой по России.{% endif %}",
  "url": "{{ request.url }}",
  "numberOfItems": {{ products|length }},
  "itemListElement": [
    {% for product in products %}
    {
      "@type": "ListItem",
      "position": {{ loop.index }},
      "item": {
        "@type": "Product",
        "name": "{{ product.name }}",
        "url": "{{ request.base_url }}product/{{ product.slug }}",
        {% if product.main_image_url %}
        "image": "{{ request.base_url }}{{ product.main_image_url[1:] }}",
        {% endif %}
        {% if product.price %}
        "offers": {
          "@type": "Offer",
          "price": "{{ product.price | round(0) }}",
          "priceCurrency": "RUB",
          "availability": "https://schema.org/InStock"
        },
        {% endif %}
        "brand": {
          "@type": "Brand",
          "name": "Luce di Villa"
        }
      }
    }{% if not loop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>

<!-- BreadcrumbList Schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Главная",
      "item": "{{ request.base_url }}"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{% if current_category %}{{ current_category.name }}{% else %}Каталог{% endif %}",
      "item": "{{ request.url }}"
    }
  ]
}
</script>
{% endblock %}

{% block extra_styles %}
<style>
    .furniture-card {
        transition: all 0.3s ease;
    }

    .filter-btn {
        transition: all 0.3s ease;
        background-color: white;
        color: #7E7670;
        border: 1px solid #7E7670;
        text-decoration: none;
        display: inline-block;
    }

    .filter-btn:hover {
        background-color: #7E7670;
        color: white;
        text-decoration: none;
    }

    .filter-btn.active {
        background-color: #7E7670 !important;
        color: white !important;
        border-color: #7E7670 !important;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    .furniture-card {
        animation: fadeIn 0.3s ease-out;
    }
</style>
{% endblock %}

{% block content %}

<main class="w-full py-12">
    <!-- Page Title -->
    <section class="mb-12">
        <div class="max-w-7xl mx-auto px-8">
            <h1 class="text-3xl lg:text-4xl text-brand-dark uppercase tracking-[0.15em]">
                {% if current_category %}{{ current_category.name }}{% else %}Каталог{% endif %}
            </h1>
            {% if current_category and current_category.description %}
            <p class="mt-4 text-brand-dark/70 max-w-2xl">{{ current_category.description }}</p>
            {% endif %}
        </div>
    </section>

    <!-- Filters -->
    <section class="mb-16">
        <div class="max-w-7xl mx-auto px-8">
            <div class="flex flex-wrap gap-4 justify-center lg:justify-start">
                <a href="{{ url_for('catalog') }}"
                   class="filter-btn {% if not current_category %}active{% endif %} px-5 py-2 text-xs uppercase tracking-[0.15em] font-light">
                    Все
                </a>
                {% for category in categories %}
                <a href="{{ url_for('catalog_category', category_slug=category.slug) }}"
                   class="filter-btn {% if current_category and current_category.slug == category.slug %}active{% endif %} px-5 py-2 text-xs uppercase tracking-[0.15em] font-light">
                    {{ category.name }}
                </a>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Products Grid -->
    {% include 'partials/products_grid.html' %}
</main>
{% endblock %}

{% block scripts %}
{{ super() }}
{% endblock %}